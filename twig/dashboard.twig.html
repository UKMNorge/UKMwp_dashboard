<script>
	jQuery(document).on('click', '.doLike', function(){
		console.log('doLike');

		var article = jQuery(this).parents('.likeAction');
		var icon = article.find('.likeIcon');
		var liked = icon.attr('src').indexOf( 'icon-like-full' ) > 0;
		var countContainer = article.find('.likeCount');

		if( liked ) {
			icon.attr('src', icon.attr('src').replace('icon-like-full', 'icon-like-medium'));
		} else {
			icon.attr('src', icon.attr('src').replace('icon-like-medium', 'icon-like-full'));
		}
					
		jQuery.post(
			ajaxurl, 
			{
				'action':'UKMdashboard_ajax',
				'blog_id': article.attr('data-blog-id'),
				'post_id': article.attr('data-post-id'),
				'newsAction': liked ? 'dislike' : 'like',
			}
			, function(response) {
				console.log( response );
				if(response.success) {
					countContainer.html( response.newCount );
					return;
				}
				alert('Beklager, kunne ikke lagre.');
				if( liked ) {
					icon.attr('src', icon.attr('src').replace('icon-like-medium', 'icon-like-full'));
				} else {
					icon.attr('src', icon.attr('src').replace('icon-like-full', 'icon-like-medium'));
				}
			}
		);
	});
</script>

{% if post is defined %}
	{% embed "post.twig.html" %}{% endembed %}
{% else %}
	{% if page == 1 %}
		<div class="clearfix"></div>
		<div class="header-dashboard" style="margin: 0px 0px 1em -20px;">ARRANGÃ˜RSYSTEMET</div>
		<div class="clearfix"></div>
	{% endif %}
	
	<div class="container-fluid dashboard">
		<div class="row">
			{% if page == 1 %}
				<div class="col-xs-12 col-sm-4 pull-right">
					{% if deltakerbruker is defined and deltakerbruker %}
						<div>
							{% embed "blogvalg.twig.html" %}{% endembed %}
						</div>
					{% else %}
						<div>
							{% embed "meldinger.twig.html" %}{% endembed %}
						</div>
					{% endif %}
					<div>
						{% embed "kalender.twig.html" %}{% endembed %}
					</div>
					{% if block_pre_messages is defined %}
						{% for bm in block_pre_messages %}
							<div>
								{{ bm|raw }}
							</div>
						{% endfor %}
					{% endif %}
					{% if site_type %}
						<div>
							{% embed "pameldte.twig.html" %}{% endembed %}
						</div>
					{% endif %}

					{% if deltakerbruker is defined and deltakerbruker %}
						<div>
							{% embed "profil.twig.html" %}{% endembed %}
						</div>
					{% endif %}
				</div>
			{% endif %}
			
			<div class="col-xs-12 col-sm-8">
				{% for post in news %}
					<div class="col-xs-6">
						{% embed "news.twig.html" %}{% endembed %}
					</div>
					{% if loop.index is divisible by ( 2 ) %}
						<div class="clearfix" style="margin-bottom: 2em;"></div>
					{% endif %}
				{% endfor %}
			</div>
		</div>
		
		
		<div class="row">
			{% if pagination_prev is defined %}
				<div class="col-xs-6">
					<a href="?pagination={{pagination_prev}}" class="btn btn-default pull-left">Nyere saker</a>
				</div>
			{% endif %}
			
			{% if pagination_next is defined %}
				<div class="col-xs-6">
					<a href="?pagination={{pagination_next}}" class="btn btn-default pull-right">Eldre saker</a>
				</div>
			{% endif %}
		</div>
	</div>
{% endif %}